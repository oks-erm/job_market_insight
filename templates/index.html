<!DOCTYPE html>
<html>

<head>
    <title>Job Search</title>
    <link rel="stylesheet" href="static/css/style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <h1>Job Search Results</h1>
    <div id="searchFormContainer">
        <form id="searchForm">
            <label for="keywords">Keywords:</label>
            <input type="text" id="keywordsInput" name="keywords" required>
            <br>
            <label for="location">Location:</label>
            <input type="text" id="locationInput" name="location" required>
            <br>
            <button type="submit">Search</button>
        </form>
    </div>
    <div id="loader" style="display: none;">
        <div class="loading">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div id="resultsContainer" style="display: none;">
        <p>Location: <span id="location"></span></p>
        <p>Keyword: <span id="keywords"></span></p>
    </div>
    <div id="plotContainer" style="display: none;">
        <h2>Top Skills Plot:</h2>
        <div id="plot"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.1/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
        var socket = io();

        socket.on('connect', function () {
            socket.emit('my event', { data: 'I\'m connected!' });
            // Handle the search form submission
            $('#searchForm').submit(function (event) {
                event.preventDefault(); 
                // Hide the results container and show the loader
                $('#resultsContainer').hide();
                $('#plotContainer').hide();
                $('#loader').show();
                // Get the form values
                let keywords = $('#keywordsInput').val();
                let location = $('#locationInput').val();
                socket.emit('search', { keywords: keywords, location: location });
            });
        });

        socket.on('update_plot', function (data) {
            // Hide the loader and show the results container
            $('#loader').hide();
            $('#resultsContainer').show();
            // Parse the JSON data received from the backend
            let jsonData = JSON.parse(data.plot_json);
            // Update the existing Plotly graph with the new data and layout
            Plotly.react('plot', jsonData.data, jsonData.layout);
            $('#plotContainer').show();
        });
    });
    </script>

</body>

</html>

